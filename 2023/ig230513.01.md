[top](../index.html) 
 / [index](index.html) 
 / [prev](ig230414.01.html) 
 / [next](../2024/ig240710.01.html) 
 / [target](https://uedaueo.github.io/diary-of-tueda/2023/ig230513.01.html) 
 / [source](https://github.com/uedaueo/diary-of-tueda/blob/master/2023/ig230513.01.src.md) 

2023-05-13 diary: [blancofw] blancoFramework 上田版 v3.x をリリース
=====================================================================================================
![tueda's diary](https://uedaueo.github.io/diary-of-tueda/images/furoduck.jpg "うえだうえお") **tueda's diary**

## [blancofw] blancoFramework 上田版 v3.x をリリース

[先日アナウンスした](./ig230411.html)通り、blancoFramework上田版のv3.xをリリースしました。

こまごまと依存ライブラリのアップデートなどしつつ、一番大きな（ある意味破壊的な）変更は、

* **target を 11 (class バージョン 55) に変更**

した事です。class バージョンの統一は必ずしも必須ではありませんが、この機に上田版のメジャーバージョンは 3 とし、配置先のオレオレ maven repository （のブランチ）も変更しました。v3 以降を使う場合は

```
https://raw.github.com/uedaueo/blancofw-maven2/gh-pages-v3/
```

を maven リポジトリとして指定してください。v2 以前を使用する場合は従来通り、gh-pages-poi5 を指定するようにしてください。理由は後述しますが、リポジトリを混ぜると maven の依存関係が混乱する恐れがあります。

### 依存関係について

blancofw の各ツールはそれら自体が blancofw によって構築されているので、各ツールが相互依存関係になっています。blancofw はソースコードを生成するツールであり、それ自体は実行時（runtime）には必要とされません。つまり、本質的には各ツールのバージョンを揃える必要はありませんし、相互依存関係になっていることもアプリケーション実行時にはまったく問題とはなりません。

なのでこれまではあまり厳密にバージョン管理がされていなかったのだと思います。とはいえ、どのツール使うのにどのツールが必要なのか良く分からない状況で、とりあえず ant プロジェクトの lib に全部ツッコんどけ、というやり方に少々もにょっていたのも事実です。

上田版では maven に完全対応したことで、依存関係が maven によって管理されるようになりました。これでバージョン管理を気にしないですむ、と思っていたのですが、今回、jar の class を 55 に上げてツールのバージョンメジャー番号を 3 に統一しようと思っておおはまりしました。

相互依存している物の dependency を固定値で定義すると、どれかのツールを上げる度に関連するツールもビルドし直す必要がでてきます。これはとても面倒なので、blancofw を maven 化した際に（igapyon さんが）バージョン指定は範囲で指定しています。

```
[2.0, 3.0)
```

な感じで。これはとても便利で、私もこの方式を踏襲していたのですが、あるツールのメジャーバージョンを上げても、依存関係で別のツールは低いメジャーバージョンが選択され、回り回って同じツールに対して複数のメジャーバージョンが選択された状態になりました。当然これではバージョンが競合していると maven に怒られてビルドが進みません。

そんなわけでいよいよ、依存関係について整理することにしました。

とりあえずメジャーバージョンの競合については、ローカルの maven リポジトリを**直接修正して無理矢理解決**しました。

その後、依存関係を図の様に整理して、相互依存する物の依存関係の定義は blancoCommons に集約し、各ツールは blancoCommons のみを参照することで、transitive dependeies で依存関係の解決をしてもらう様にしました。

![上田版 blancofw の依存関係図](https://uedaueo.github.io/diary-of-tueda/images/2023/20230513_01_dependencies.png "上田版 blancofw の依存関係図")

図の左側の11個のツールと blancoCommons が blancofw の基本的なツールであり、相互依存する物となります。右側は blancofw の基本ツールを使用しつつ、独自の目的に合わせてソースコードを生成するツール類です。こちらは相互依存しないように依存関係を整理しました。

今後、blancofw に新たなツール（たとえば C# 版の blancoRestGeneratorとか？）を追加する場合は、相互依存にならないように blancoCommons の右側に伸びる形で依存関係を構築していくことにします。

これで、次のメジャーバージョンアップの時は

* blancoCommons が参照する基本ツールのバージョンを [3.0,5.0) に修正
* 図左側の各基本ツールのメジャーバージョンを 4.0.0 にし、参照する blancoCommons を [3.0,5.0) とする
* blancoCommons のバージョンを 4.0.0 にし、参照する基本ツールのバージョンを [4.0,5.0) に修正する
* 図右側の各ツールのメジャーバージョンを 4.0.0 にし、参照する blancoCommons を [4.0, 5.0) にする
* 各基本ツールが参照する blancoCommons は適宜 [4.0,5.0) に変えて行く

という手順で、無理矢理な事をせずにバージョンアップできるようになるのではないかな？と思っています（が、まあダメでもローカルリポジトリでバージョン調整すればなんとかなる事はわかったので、、、(；´Д｀)）。

### バージョン番号ポリシー

今後のバージョン番号については概ね以下の方針であげてきます。

| 項目 | 内容 |
|-----|-----|
|メジャー|破壊的変更があった場合に上げます。新たなツールの追加はメジャーバージョンを上げる要因とはなりません。一部のツールだけの事であっても、全ツールのバージョンを上げます。使用する場合はメジャーバージョンの同じ物を使うようにしてください。|
|ミドル|コマンドラインオプションで動作切り替えが発生するような機能追加があった場合に上げます。ツール毎にあげていきます。|
|マイナー|バグフィックスや僅かな機能追加（定義書の項目追加程度）の修正はマイナーバージョンを上げます。|

基本的には破壊的変更は行わない方針です。メジャーバージョンが同じである限り、従来の定義書からは従来と機能的に同じソースコードが生成され、アプリケーションには影響を及ぼさない事を前提とします。

アプリケーションの再ビルドなどが必要となるような修正が発生した場合はメジャーバージョンをアップし、アプリにて dependency の修正を行わない限り従来のメジャーバージョンが使用される事を前提とします。

Last modified: $Date: 2023-05-13 $

## 登場キーワード

* blancofw

----------------------------------------------------------------------------------------------------

## About tueda's diary

* この日記はうえだうえお (aka 上田達也) が書いています。概ね個人の意見ですが、たまに有限会社うえだうえおうぇあを代表して発言する事があります。
* [Share on Twitter](https://twitter.com/intent/tweet?hashtags=tueda%2Cuedaueo&text=%5Bblancofw%5D+blancoFramework+%E4%B8%8A%E7%94%B0%E7%89%88+v3.x+%E3%82%92%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9&url=https%3A%2F%2Fuedaueo.github.io%2Fdiary-of-tueda%2F2023%2Fig230513.01.html) / [top](../index.html) / [Powered by Igapyonv3](https://github.com/igapyon/igapyonv3)
