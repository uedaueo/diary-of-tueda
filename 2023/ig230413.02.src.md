## [igapyonv3] 1日に複数本の日記を書く方法について

先日から使い始めた [[igapyonv3]] 日記システムについて、分かった事を少しづつ書いて行きます。今回のお題は「1日に複数本の日記を書く方法について」

### 結論

基本的には以下の通り。

* settings.src.md で、```${setGeneratetodaydiary("false")}``` とする
* 既存の日記をコピるとかして、```2023/ig20230413.01.src.md``` という名前のファイルを作る
* 既存の日記をコピるとかして、```2023/ig20230413.02.src.md``` という名前のファイルを作る
  * ポイントは、ファイル名を ```ig<今日の日付>.<連番>.src.md``` とすることです。連番をピリオド区切りでつけます。
  * お好みで ```<@lastmodified date="2023-04-13"/>``` この辺も調整する
* mvn compile を**2回実行**する
* 生成されたファイルを commit する

### 前提

**「先生、同じ日に違ったテーマで日記が書きたいです！」**

や、書けば良いんですけどね。igapyonv3 日記システムでは、原則として ```ig20230413.src.md``` 的なファイルに1日分の日記を書きます。「日記」なんだから、1日1ファイルっていうのも、まあ普通。当然ですね。しかし問題は、index の生成です。

* **igapyonv3 では、最初の ## で設定された見出しが、日記のタイトルとなります**

つまり、1日に違うテーマで複数の日記を書きたい場合、たとえ ```##``` で内容を区切っても、ひとつめの見出ししか日記一覧には表示されないのです！ｶﾞ━━(;ﾟДﾟ)━━ﾝ!!
これについてはソースコードにもこんな記述が。

```
			// 最初の ## からテキストを取得。これは igapyonv3 の最大の制約です。
```

igapyonさん、、、ま、まあ出来ない物は仕方がないので、私の初日（4/11）の日記では以下の様にしました。

* ```##``` には、複数のテーマを / で区切って書く
* ```###``` で、各テーマを区切る

とりあえずこれで、その日何を書いたのかは読者の皆様にお伝えすることができます（ていうかむしろ、私の日記は自分のための備忘録なので、自分があとで探せる事が重要）。
とはいえこれだと、1日に沢山書くと見出しが破綻するんですよねえ、、、まあそんなに日記ばかり書いてないでコードを書け、という話でもあるんですが(´・ω・`)


### ig20230413-01.rc.md とかどう？

まあでもこれ、なんとなく見てると、フォルダ内のファイルを舐めてそれを順番に処理しているだけのような気が。それなら、その日の分の雛形を自動生成させるのをやめて、自分で

```
ig20230413-01.rc.md
```

みたいなファイルを置いちゃえばいいのでは？と思ってやってみたら、これ自体はうまくいきました！（こういう柔軟性の高さは igapyon さんのツールの特徴ですね）

ただしこれにも問題があって、**日記タイトルに日付が反映されません**。タイトルの日付が、日記一覧でいつの日記なのかを知る唯一の手がかりなので、これがないとかなり辛いです。

### ig20230413.01.src.md だった！

でまあ、タイトルの成形はどこでどうやってるんだ？ってのでソースコードを漁った所、

```
Pattern.compile("ig[0-9][0-9][0-9][0-9][0-9][0-9]\\.");
```

てのがあって、これにマッチしたファイルだけが「日記」として識別されて、タイトルに日付が付与されるようです。いやあ、普通にファイル読み込みでやってるのかと思ったら、わざわざ Template エンジンの拡張として実装されていたので、ちょっと手間取りましたｗ

ということで、結論としては、ファイル名を

```
ig + <日付> + . + <連番>　+ .src.md
```

として作ってあげれば、思惑通り、ちゃんと日記が生成されて、index や atom でも 連番でソートされて並びました！ただしデフォルトでは ```compile``` フェーズでその日の日記雛形が自動生成されてしまうので、これを止めておかなければゴミページが出来てしまいます。これは、```settings.src.md``` で

```
${setGeneratetodaydiary("false")}
```

としておけば止まります。

### TODO

キーワード一覧の生成と、日記からの/へのリンクがまだうまくいってませんが、まあこれは追々。これでやっと本題の blancofw の話とかができるｗ

<@lastmodified date="2023-04-13"/>
